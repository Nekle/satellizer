/**
 * Satellizer 0.9.4
 * (c) 2015 Sahat Yalkabov
 * License: MIT
 */
!function(t,e){"use strict";e.module("satellizer",[]).constant("satellizer.config",{httpInterceptor:!0,loginOnSignup:!0,loginRedirect:"/",logoutRedirect:"/",signupRedirect:"/login",loginUrl:"/auth/login",signupUrl:"/auth/signup",loginRoute:"/login",signupRoute:"/signup",tokenRoot:!1,tokenName:"token",tokenPrefix:"satellizer",authHeader:"Authorization",withCredentials:!0,platform:"browser"}).provider("$auth",["satellizer.config",function(t){Object.defineProperties(this,{httpInterceptor:{get:function(){return t.httpInterceptor},set:function(e){t.httpInterceptor=e}},loginOnSignup:{get:function(){return t.loginOnSignup},set:function(e){t.loginOnSignup=e}},logoutRedirect:{get:function(){return t.logoutRedirect},set:function(e){t.logoutRedirect=e}},loginRedirect:{set:function(e){t.loginRedirect=e},get:function(){return t.loginRedirect}},signupRedirect:{get:function(){return t.signupRedirect},set:function(e){t.signupRedirect=e}},loginUrl:{get:function(){return t.loginUrl},set:function(e){t.loginUrl=e}},signupUrl:{get:function(){return t.signupUrl},set:function(e){t.signupUrl=e}},loginRoute:{get:function(){return t.loginRoute},set:function(e){t.loginRoute=e}},signupRoute:{get:function(){return t.signupRoute},set:function(e){t.signupRoute=e}},tokenRoot:{get:function(){return t.tokenRoot},set:function(e){t.tokenRoot=e}},tokenName:{get:function(){return t.tokenName},set:function(e){t.tokenName=e}},tokenPrefix:{get:function(){return t.tokenPrefix},set:function(e){t.tokenPrefix=e}},authHeader:{get:function(){return t.authHeader},set:function(e){t.authHeader=e}},withCredentials:{get:function(){return t.withCredentials},set:function(e){t.withCredentials=e}},platform:{get:function(){return t.platform},set:function(e){t.platform=e}}}),this.$get=["$q","satellizer.shared","satellizer.local",function(t,e,n){var o={};return o.login=function(t,e){return n.login(t,e)},o.signup=function(t){return n.signup(t)},o.logout=function(t){return e.logout(t)},o.isAuthenticated=function(){return e.isAuthenticated()},o.getToken=function(){return e.getToken()},o.setToken=function(t,n){e.setToken({access_token:t},n)},o.removeToken=function(){return e.removeToken()},o.getPayload=function(){return e.getPayload()},o}]}]).factory("satellizer.shared",["$q","$window","$location","satellizer.config","satellizer.storage",function(t,n,o,r,i){var u={},a=r.tokenPrefix?r.tokenPrefix+"_"+r.tokenName:r.tokenName;return u.getToken=function(){return i.get(a)},u.getPayload=function(){var t=i.get(a);if(t&&3===t.split(".").length){var e=t.split(".")[1],o=e.replace("-","+").replace("_","/");return JSON.parse(n.atob(o))}},u.setToken=function(t,n){var u,c=t&&t.access_token;if(c&&(e.isObject(c)&&e.isObject(c.data)?t=c:e.isString(c)&&(u=c)),!u&&t&&(u=r.tokenRoot&&t.data[r.tokenRoot]?t.data[r.tokenRoot][r.tokenName]:t.data[r.tokenName]),!u){var l=r.tokenRoot?r.tokenRoot+"."+r.tokenName:r.tokenName;throw new Error('Expecting a token named "'+l+'" but instead got: '+JSON.stringify(t.data))}i.set(a,u),r.loginRedirect&&!n?o.path(r.loginRedirect):n&&e.isString(n)&&o.path(encodeURI(n))},u.removeToken=function(){i.remove(a)},u.isAuthenticated=function(){var t=i.get(a);if(t){if(3===t.split(".").length){var e=t.split(".")[1],o=e.replace("-","+").replace("_","/"),r=JSON.parse(n.atob(o)).exp;if(r)return Math.round((new Date).getTime()/1e3)<=r}return!0}return!1},u.logout=function(n){return i.remove(a),r.logoutRedirect&&!n?o.url(r.logoutRedirect):e.isString(n)&&o.url(n),t.when()},u}]).factory("satellizer.local",["$q","$http","$location","satellizer.utils","satellizer.shared","satellizer.config",function(t,e,n,o,r,i){var u={};return u.login=function(t,n){return e.post(i.loginUrl,t).then(function(t){return r.setToken(t,n),t})},u.signup=function(t){return e.post(i.signupUrl,t).then(function(t){return i.loginOnSignup?r.setToken(t):i.signupRedirect&&n.path(i.signupRedirect),t})},u}]).service("satellizer.utils",function(){this.camelCase=function(t){return t.replace(/([\:\-\_]+(.))/g,function(t,e,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(t){var n,o,r={};return e.forEach((t||"").split("&"),function(t){t&&(o=t.split("="),n=decodeURIComponent(o[0]),r[n]=e.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),r}}).factory("satellizer.storage",function(){function e(){try{return"localStorage"in t&&null!==t.localStorage}catch(e){return!1}}return e()?{get:function(t){return localStorage.getItem(t)},set:function(t,e){return localStorage.setItem(t,e)},remove:function(t){return localStorage.removeItem(t)}}:(console.warn("Warning: Browser Local Storage is disabled or unavailable. Satellizer will not work correctly."),{get:function(){},set:function(){},remove:function(){}})}).factory("satellizer.interceptor",["$q","satellizer.config","satellizer.storage",function(t,e,n){var o=e.tokenPrefix?e.tokenPrefix+"_"+e.tokenName:e.tokenName;return{request:function(t){var r=n.get(o);return r&&e.httpInterceptor&&(r="Authorization"===e.authHeader?"Bearer "+r:r,t.headers[e.authHeader]=r),t},responseError:function(e){return t.reject(e)}}}]).config(["$httpProvider",function(t){t.interceptors.push("satellizer.interceptor")}])}(window,window.angular),function(){function t(t){this.message=t}var e="undefined"!=typeof exports?exports:this,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=new Error,t.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var o,r,i=String(e),u=0,a=n,c="";i.charAt(0|u)||(a="=",u%1);c+=a.charAt(63&o>>8-u%1*8)){if(r=i.charCodeAt(u+=.75),r>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|r}return c}),e.atob||(e.atob=function(e){var o=String(e).replace(/=+$/,"");if(o.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,i,u=0,a=0,c="";i=o.charAt(a++);~i&&(r=u%4?64*r+i:i,u++%4)?c+=String.fromCharCode(255&r>>(-2*u&6)):0)i=n.indexOf(i);return c})}();